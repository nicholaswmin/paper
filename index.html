<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="a paperjs scratch experiment">
    <title>PaperJS â€” paper</title>
    <style>
      :root {
        accent-color: #ffcc00;
      }

      html,
      body {
        height: 100%;
        margin: 0;
      }

      body {
        overflow: hidden;
      }

      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }

      menu {
        position: fixed;
        top: 1rem;
        right: 1rem;
        margin: 0;
        padding: 0.5rem;
        list-style: none;
      }
    </style>
  </head>
  <body>
    <menu>
      <li>
        <input type="range" min="0.5" max="5" step="0.1"
          value="1" title="zoom"
          orient="vertical"
          oninput="ui.view.zoom(this)">
      </li>
    </menu>
    <canvas id="c" resize></canvas>
    <script src="./lib/paper-core.js"></script>
    <script>
      paper.setup(document.querySelector('#c'))

      const cell = (i, cols, size, bounds, style) =>
        i < cols
          ? new paper.Path.Line({
              from: [bounds.x + i * size, bounds.y],
              to: [bounds.x + i * size, bounds.y + bounds.height],
              ...style,
            })
          : new paper.Path.Line({
              from: [bounds.x, bounds.y + (i - cols) * size],
              to: [bounds.x + bounds.width, bounds.y + (i - cols) * size],
              ...style,
            })

      const grid = (
        size = 20,
        style = { strokeWidth: 1, strokeColor: 'lightblue' }
      ) => {
        const bounds = paper.view.bounds
        const cols = Math.ceil(bounds.width / size) + 1

        return Array.from({
          length: cols + Math.ceil(bounds.height / size) + 1
        }, (_, i) => i).reduce((group, i) =>
          (group.addChild(cell(i, cols, size, bounds, style)), group)
        , new paper.Group())
      }

      const ui = {
        view: {
          init: () => {
            grid().set({ name: 'grid' }).sendToBack()

            new paper.Raster({
              source: 'https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png',
              position: paper.view.center,
            })
          },
          redraw: () => {
            paper.project.activeLayer.children['grid']?.remove()
            grid().set({ name: 'grid' }).sendToBack()
          },
          zoom: el => {
            paper.view.zoom = +el.value
            ui.view.redraw()
          }
        }
      }

      ui.view.init()
    </script>
  </body>
</html>
